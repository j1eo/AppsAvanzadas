@page "/about"
@inherits LayoutComponentBase

@implements IDisposable

@inject NavigationManager NavManager

<TelerikRootComponent IconType="@IconType.Font">
    <AppsAvanzadas.Components.Pages.MainMenu />

    <!-- Espaciador para que el contenido no quede oculto bajo el header fijo -->
    <div class="header-spacer"></div>

    <main>
        @Body

        <!-- ===== Banner de imagen ===== -->
        <section class="hero-banner">
            <div class="container">
                <div class="ratio ratio-21x9 hero-banner-frame">
                    <!-- Usa tu ruta real de imagen -->
                    <img src="https://www.ragasa.com.mx/wp-content/uploads/2016/12/Banner-familia-Ragasa-730x215-px-2.png" alt="Alternate Text" class="w-100 h-20 object-fit-cover rounded-3" />
                </div>
            </div>
        </section>

        <!-- ===== Bloque de direcciones ===== -->
        <section class="locations-strip py-5">
            <div class="container">
                <div class="row gy-4">
                    @foreach (var loc in Locations)
                    {
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="location-item h-100 p-3 bg-white rounded-3 shadow-sm">
                                <div class="d-flex align-items-start">
                                    <span class="pin-icon me-3" aria-hidden="true">
                                        <!-- Pin SVG -->
                                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                            <path d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z" />
                                        </svg>
                                    </span>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-2 fw-semibold text-dark">@loc.Title</h6>
                                        <div class="small text-body-secondary mb-2">
                                            @((MarkupString)loc.AddressHtml)
                                        </div>
                                        @if (!string.IsNullOrWhiteSpace(loc.Phone))
                                        {
                                            <div class="small">
                                                <span class="fw-semibold">Teléfono:</span> @loc.Phone
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </section>

        <TelerikMediaQuery Media="(min-width: 641px)" OnChange="@OnMediaQueryChange" />
    </main>
    </TelerikRootComponent>

@code {
    private sealed record Location(string Title, string AddressHtml, string? Phone);

    private readonly List<Location> Locations = new()
    {
    new(
    "Oficinas Centrales / Comerciales",
    @"<div>Av. José Eleuterio González 2815, col. Mitras Norte. C.P. 64320, Monterrey, N.L., México.</div>",
    "(+52) 81 8389 – 7500"
    ),
    new(
    "Oficina Comercial Guadalajara",
    @"<div>Calle: Jesús Ramírez #54, Colonia: López Cotilla, CP: 45615 Municipio: San Pedro Tlaquepaque, Jal.</div>",
    "(+52) 33 3688 – 0770"
    ),
    new(
    "Oficina Comercial Ciudad de México",
    @"<div>Calzada de Guadalupe El cerrito Cuautepec, México. Estado de México CP 54879 parque industrial Interpark II</div>",
    "(+52) 55 1940 – 3650"
    ),
    new(
    "Planta Ragasa",
    @"<div>Vía Tampico Km 501.5, C.P. 67120, Guadalupe, N.L. México. Apdo. Postal 99</div>",
    "(+52) 81 8196 – 0100"
    ),
    new(
    "Oficina Matamoros",
    @"<div>Km. 0.5 Antiguo Sendero Nacional, C.P. 87350 Zona Industrial Matamoros, Tamaulipas. Apdo. Postal 184</div>",
    "(+52) 868 811 – 1200"
    ),
    new(
    "Oficina USA",
    @"<div>2001 Timberloch Place, Suite 500 The Woodlands, Texas 77380</div>",
    null
    )
    };

    private IEnumerable<NavItem> DrawerData { get; set; } = new List<NavItem>()
    {
    new NavItem("Home", FontIcon.Home, "/"),
    new NavItem("Counter", FontIcon.CustomFormat, "/counter"),
    new NavItem("Weather", FontIcon.Globe, "/weather"),
    new NavItem("About", FontIcon.InfoCircle, "/about")
    };

    private bool DrawerExpanded { get; set; } = true;

    private NavItem? DrawerSelectedItem { get; set; }

    private bool LargeScreen { get; set; } = true;

    private void OnMediaQueryChange(bool mediaQueryMatched)
    {
        LargeScreen = DrawerExpanded = mediaQueryMatched;
    }

    private void DrawerExpandedChanged(bool newExpanded)
    {
        if (!LargeScreen && !newExpanded)
        {
            DrawerExpanded = newExpanded;
        }
    }

    private void SelectDrawerItem()
    {
        var url = NavManager.Uri.Replace(NavManager.BaseUri, "/").ToLowerInvariant();

        DrawerSelectedItem = DrawerData.FirstOrDefault(x => x.Url.ToLowerInvariant() == url);
    }

    private void NavManagerLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        var url = args.Location.Replace(NavManager.BaseUri, "/").ToLowerInvariant();

        DrawerSelectedItem = DrawerData.FirstOrDefault(x => x.Url.ToLowerInvariant() == url);

        InvokeAsync(StateHasChanged);
    }

    protected override void OnInitialized()
    {
        SelectDrawerItem();

        NavManager.LocationChanged += NavManagerLocationChanged;

        base.OnInitialized();
    }

    public void Dispose()
    {
        if (NavManager != null)
        {
            NavManager.LocationChanged -= NavManagerLocationChanged;
        }
    }

    public class NavItem
    {
        public string Text { get; set; }
        public object? Icon { get; set; }
        public string Url { get; set; } = string.Empty;

        public NavItem(string text, object? icon, string url)
        {
            Text = text;
            Icon = icon;
            Url = url;
        }
    }
}
